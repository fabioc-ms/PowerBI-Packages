{"visual":{"name":"PBIRPackages","displayName":"List PBI R Packages","guid":"VerbatimExplorerD13F83D6C74E41AEAFBA81E2A78FFEDD","visualClassName":"Visual","version":"1.0.0","description":"Discover what R packages are installed in the Power BI Service. Even the undocumented ones.","supportUrl":"https://github.com/fabioc-ms/PowerBI-Packages","gitHubUrl":"https://github.com/fabioc-ms/PowerBI-Packages"},"apiVersion":"1.7.0","author":{"name":"Fabio Correa","email":"fabio@correa.net"},"assets":{"icon":"assets/icon.png"},"externalJS":["node_modules/powerbi-visuals-utils-dataviewutils/lib/index.js"],"style":"style/visual.less","capabilities":{"dataRoles":[{"displayName":"Values","kind":"GroupingOrMeasure","name":"Values"}],"dataViewMappings":[{"scriptResult":{"dataInput":{"table":{"rows":{"select":[{"for":{"in":"Values"}}],"dataReductionAlgorithm":{"top":{}}}}},"script":{"scriptProviderDefault":"R","scriptOutputType":"html","source":{"objectName":"rcv_script","propertyName":"source"},"provider":{"objectName":"rcv_script","propertyName":"provider"},"scriptSourceDefault":"\r\n\r\nif (Sys.getenv(\"RSTUDIO\") == 1) { ### 1 -> development enviroment\r\n  \r\n  libraryRequireInstall = function(packageName, ...)\r\n  {\r\n    if(!require(packageName, character.only = TRUE))\r\n      warning(paste(\"*** The package: '\", packageName, \"' was not installed ***\", sep=\"\"))\r\n  }\r\n  \r\n  internalSaveWidget <- function(widget, fname)\r\n  {\r\n    widget\r\n  }\r\n  \r\n} else {\r\n\r\n############### Utility functions ###############\nlibraryRequireInstall = function(packageName, ...)\n{\n  if(!require(packageName, character.only = TRUE)) \n    warning(paste(\"*** The package: '\", packageName, \"' was not installed ***\", sep=\"\"))\n}\n\nlibraryRequireInstall(\"XML\")\nlibraryRequireInstall(\"htmlwidgets\")\n\ninternalSaveWidget <- function(widget, fname)\n{\n  tempFname = paste(fname, \".tmp\", sep=\"\")\n  htmlwidgets::saveWidget(widget, file = tempFname, selfcontained = FALSE)\n  FlattenHTML(tempFname, fname)\n}\n\nFlattenHTML <- function(fnameIn, fnameOut)\n{\n  # Read and parse HTML file\n  # Embed all js and css files into one unified file\n  \n  if(!file.exists(fnameIn))\n    return(FALSE)\n  \n  dir = dirname(fnameIn)\n  html = htmlTreeParse(fnameIn, useInternal = TRUE)\n  top = xmlRoot(html)\n  \n  # extract all <script> tags with src value\n  srcNode=getNodeSet(top, '//script[@src]')\n  for (node in srcNode)\n  {\n    b = xmlAttrs(node)\n    fname = file.path(dir, b['src'])\n    alternateSrc = FindSrcReplacement(fname)\n    if (!is.null(alternateSrc))\n    {\n      s = alternateSrc\n      names(s) = 'src'\n      newNode = xmlNode(\"script\",attrs = s)\n      replaceNodes(node, newNode)\n    }else{\n      str=ReadFileForEmbedding(fname);\n      if (!is.null(str))\n      {      \n        newNode = xmlNode(\"script\", str, attrs = c(type = \"text/javascript\"))\n        replaceNodes(node, newNode)\n      }\n    }\n  }\n  \n  # extract all <link> tags with src value\n  linkNode=getNodeSet(top, '//link[@href]')\n  for (node in linkNode)\n  {\n    b = xmlAttrs(node)\n    fname = file.path(dir, b['href'])\n    str = ReadFileForEmbedding(fname, FALSE);\n    if (!is.null(str))\n    {\n      newNode = xmlNode(\"style\", str)\n      replaceNodes(node, newNode)\n    }\n  }\n  \n  saveXML(html, file = fnameOut)\n  return(TRUE)\n}\n\nReadFileForEmbedding <- function(fname, addCdata = TRUE)\n{\n  data = ReadFullFile(fname)\n  if (is.null(data))\n    return(NULL)\n\n  str = paste(data, collapse ='\\n')\n  if (addCdata) {\n    str = paste(cbind('// <![CDATA[', str,'// ]]>'), collapse ='\\n')\n  }\n  return(str)\n}\n\nReadFullFile <- function(fname)\n{\n  if(!file.exists(fname))\n    return(NULL)\n  \n  con = file(fname, open = \"r\")\n  data = readLines(con)\n  close(con)\n  return(data)\n}\n\nFindSrcReplacement <- function(str)\n{\n  # finds reference to 'plotly' js and replaces with a version from CDN\n  # This allows the HTML to be smaller, since this script is not fully embedded in it\n  str <- iconv(str, to=\"UTF-8\")\n  pattern = \"plotlyjs-(\\\\w.+)/plotly-latest.min.js\"\n  match1=regexpr(pattern, str)\n  attr(match1, 'useBytes') <- FALSE\n  strMatch=regmatches(str, match1, invert = FALSE)\n  if (length(strMatch) == 0) return(NULL)\n  \n  pattern2 = \"-(\\\\d.+)/\"\n  match2 = regexpr(pattern2, strMatch[1])\n  attr(match2, 'useBytes') <- FALSE\n  strmatch = regmatches(strMatch[1], match2)\n  if (length(strmatch) == 0) return(NULL)\n  \n  # CDN url is https://cdn.plot.ly/plotly-<Version>.js\n  # This matches the specific version used in the plotly package used.\n  verstr = substr(strmatch, 2, nchar(strmatch)-1)\n  str = paste('https://cdn.plot.ly/plotly-', verstr,'.min.js', sep='')\n  return(str)\n}\n#################################################\n\r\n  \r\n  }\r\n\r\n############### Library Declarations ###############\r\nlibraryRequireInstall(\"DT\")\r\n\r\n\r\n#######################################################\r\n# List packages in the service\r\n# Author: Fabio Correa\r\n# October 2017\r\n#######################################################\r\n\r\nlsp <- function(package, all.names = FALSE, pattern) \r\n{\r\n  package <- deparse(substitute(package))\r\n  ls(\r\n    pos = paste(\"package\", package, sep = \":\"), \r\n    all.names = all.names, \r\n    pattern = pattern\r\n  )\r\n}\r\n\r\nMyData <- data.frame(installed.packages())\r\nMyData$LibPath <- NULL\r\nMyData$License <- NULL\r\nMyData$License_is_FOSS <- NULL\r\nMyData$License_restricts_use <- NULL\r\nMyData$OS_type <- NULL\r\nMyData$MD5sum <- NULL\r\nMyData$NeedsCompilation <- NULL\r\n\r\nMyData <- MyData[order(MyData$Package),]\r\nrownames(MyData) <- NULL\r\n\r\nkt <- datatable(MyData,\r\n                class = \"compact hover stripe\", # white-space: nowrap\r\n                #filter = list(position = 'top'),\r\n                caption = paste0(\"The Power BI Service is running \", R.version.string),\r\n                width = \"100%\",\r\n                height = \"100%\",\r\n                options = list(dom = \"<'top' flp>rti\",\r\n                               autoWidth = FALSE,\r\n                               rownames = TRUE,\r\n                               searching = TRUE,\r\n                               pagingType = \"simple_numbers\",\r\n                               pageLength = 15,\r\n                               lengthMenu = c(5, 10, 15, 20, 25, 30),\r\n                               scrollY = TRUE,\r\n                               scrollX = TRUE,\r\n                               initComplete = JS(\"\r\n                                                function(settings, json) {\r\n                                                    $(this.api().table().body()).css({\r\n                                                      'font-size': '75%'\r\n                                                     });\r\n                                                    $(this.api().table().header()).css({\r\n                                                     'background-color': '#000',\r\n                                                     'color': '#fff',\r\n                                                     'font-size': '80%'\r\n                                                    });\r\n                                                 }\r\n                                              \")\r\n                )\r\n)\r\n\r\n\r\nkt$sizingPolicy$browser$padding <- 0\r\n\r\n#######################################################\r\n# Generate output\r\n\r\ninternalSaveWidget(kt, \"out.html\")\r\n\r\n"}}}],"objects":{"rcv_script":{"properties":{"provider":{"type":{"text":true}},"source":{"type":{"scripting":{"source":true}}}}}},"suppressDefaultTitle":true},"dependencies":{"cranPackages":[{"name":"htmlwidgets","displayName":"HTML Widgets","url":"https://cran.r-project.org/web/packages/htmlwidgets/index.html"},{"name":"XML","displayName":"XML","url":"https://cran.r-project.org/web/packages/XML/index.html"}]},"stringResources":{},"content":{"js":"var powerbi;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){function t(e,t,i){void 0===e&&(e=[]);var n=e;return r(n),t&&(n.identityFields=t),i&&(n.source=i),n}function r(e,t){e.grouped=t?function(){return t}:function(){return i(e)}}function i(e){for(var t,r=[],i=0,n=e.length;n>i;i++){var a=e[i];if(!t||t.identity!==a.identity){if(t={values:[]},a.identity){t.identity=a.identity;var o=a.source;void 0!==o.groupName?t.name=o.groupName:o.displayName&&(t.name=o.displayName)}r.push(t)}t.values.push(a)}return r}e.createValueColumns=t,e.setGrouped=r,e.groupValues=i}(t=e.DataViewTransform||(e.DataViewTransform={}))}(t=e.dataview||(e.dataview={}))}(t=e.utils||(e.utils={}))}(t=e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){function t(e,t){if(!e||!e.length)return-1;var r=e[0];if(r.values&&r.values.length>0)for(var n=0,a=r.values.length;a>n;++n){var o=r.values[n];if(o&&o.source&&i(o.source,t))return n}return-1}function r(e,t){if(e&&e.length)for(var r=0,n=e.length;n>r;r++)if(i(e[r].source,t))return r;return-1}function i(e,t){var r=e.roles;return r&&r[t]}function n(e,t){return null!=e&&null!=e.metadata&&e.metadata.columns&&e.metadata.columns.some(function(e){return e.roles&&void 0!==e.roles[t]})}function a(e,t){return e&&e.source&&e.source.roles&&e.source.roles[t]===!0}e.getMeasureIndexOfRole=t,e.getCategoryIndexOfRole=r,e.hasRole=i,e.hasRoleInDataView=n,e.hasRoleInValueColumn=a}(t=e.DataRoleHelper||(e.DataRoleHelper={}))}(t=e.dataview||(e.dataview={}))}(t=e.utils||(e.utils={}))}(t=e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){function t(e,t,r){if(!e)return r;var i=e[t];return void 0===i?r:i}function r(e,r,i){var n=t(e,r);return n&&n.solid?n.solid.color:i}e.getValue=t,e.getFillColorByPropertyName=r}(t=e.DataViewObject||(e.DataViewObject={}))}(t=e.dataview||(e.dataview={}))}(t=e.utils||(e.utils={}))}(t=e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){function r(t,r,i){return t?e.DataViewObject.getValue(t[r.objectName],r.propertyName,i):i}function i(e,t,r){return e&&e[t]?e[t]:r}function n(e,t,i){var n=r(e,t);return n&&n.solid?n.solid.color:i}function a(e,t,i){var n=r(e,t,i);return n&&n.solid?n.solid.color:void 0===n||null===n||\"object\"==typeof n&&!n.solid?i:n}t.getValue=r,t.getObject=i,t.getFillColor=n,t.getCommonValue=a}(t=e.DataViewObjects||(e.DataViewObjects={}))}(t=e.dataview||(e.dataview={}))}(t=e.utils||(e.utils={}))}(t=e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(t){var r;!function(t){var r,i=e.extensibility.utils.dataview.DataRoleHelper;!function(e){function t(e,t,r){if(e.categories&&e.categories.length>0){var n=e.categories[0];return n.source&&i.hasRole(n.source,t)&&i.hasRole(n.source,r)}return!1}function r(e){return void 0!==e.groupName?e.groupName:e.queryName}function n(e){var t=o(e);return null!=t&&t.imageUrl===!0}function a(e){var t=o(e);return null!=t&&t.webUrl===!0}function o(e){return e&&e.type&&e.type.misc}function u(e){return e&&e.metadata&&e.metadata.columns&&e.metadata.columns.length?e.metadata.columns.some(function(e){return n(e)===!0}):!1}e.categoryIsAlsoSeriesRole=t,e.getSeriesName=r,e.isImageUrlColumn=n,e.isWebUrlColumn=a,e.getMiscellaneousTypeDescriptor=o,e.hasImageUrlColumn=u}(r=t.converterHelper||(t.converterHelper={}))}(r=t.dataview||(t.dataview={}))}(r=t.utils||(t.utils={}))}(t=e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t=function(){function t(){}return t.getDefault=function(){return new this},t.createPropertyIdentifier=function(e,t){return{objectName:e,propertyName:t}},t.parse=function(t){var r,i=this.getDefault();if(!t||!t.metadata||!t.metadata.objects)return i;r=i.getProperties();for(var n in r)for(var a in r[n]){var o=i[n][a];i[n][a]=e.DataViewObjects.getCommonValue(t.metadata.objects,r[n][a],o)}return i},t.isPropertyEnumerable=function(e){return!t.InnumerablePropertyPrefix.test(e)},t.enumerateObjectInstances=function(e,t){var r=e&&e[t.objectName];if(!r)return[];var i={objectName:t.objectName,selector:null,properties:{}};for(var n in r)r.hasOwnProperty(n)&&(i.properties[n]=r[n]);return{instances:[i]}},t.prototype.getProperties=function(){var e=this,r={},i=Object.keys(this);return i.forEach(function(i){if(t.isPropertyEnumerable(i)){var n=Object.keys(e[i]);r[i]={},n.forEach(function(e){t.isPropertyEnumerable(i)&&(r[i][e]=t.createPropertyIdentifier(i,e))})}}),r},t}();t.InnumerablePropertyPrefix=/^_/,e.DataViewObjectsParser=t}(t=e.dataview||(e.dataview={}))}(t=e.utils||(e.utils={}))}(t=e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),powerbi;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){\"use strict\";function t(){o=0}function r(){return 0===o}function i(e,t){var r=[];if(e&&e.hasChildNodes()){for(var i=e.children,a=0;a<i.length;a++){var o=void 0;o=\"script\"===i.item(a).nodeName.toLowerCase()?n(i.item(a)):i.item(a).cloneNode(!0),t.appendChild(o),r.push(o)}return r}}function n(e){for(var t=document.createElement(\"script\"),r=e.attributes,i=0;i<r.length;i++)t.setAttribute(r[i].name,r[i].textContent),\"src\"===r[i].name.toLowerCase()&&(o++,t.onload=function(){o--});return t.innerHTML=e.innerHTML,t}function a(){var e=window.setInterval(function(){r()&&(window.clearInterval(e),window.hasOwnProperty(\"HTMLWidgets\")&&window.HTMLWidgets.staticRender&&window.HTMLWidgets.staticRender())},100)}var o=0;e.ResetInjector=t,e.injectorReady=r,e.ParseElement=i,e.RunHTMLWidgetRenderer=a}(t=e.VerbatimExplorerD13F83D6C74E41AEAFBA81E2A78FFEDD||(e.VerbatimExplorerD13F83D6C74E41AEAFBA81E2A78FFEDD={}))}(t=e.visual||(e.visual={}))}(t=e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(t){var r;!function(t){\"use strict\";var r=e.extensibility.utils.dataview.DataViewObjectsParser,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rcv_script=new n,t}return __extends(t,e),t}(r);t.VisualSettings=i;var n=function(){function e(){}return e}();t.rcv_scriptSettings=n}(r=t.VerbatimExplorerD13F83D6C74E41AEAFBA81E2A78FFEDD||(t.VerbatimExplorerD13F83D6C74E41AEAFBA81E2A78FFEDD={}))}(r=t.visual||(t.visual={}))}(t=e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(t){var r;!function(t){\"use strict\";var r=!1,i=[e.VisualUpdateType.Resize,e.VisualUpdateType.ResizeEnd,e.VisualUpdateType.Resize+e.VisualUpdateType.ResizeEnd],n=function(){function e(e){e&&e.element&&(this.rootElement=e.element),this.headNodes=[],this.bodyNodes=[]}return e.prototype.update=function(t){if(t&&t.type&&t.viewport&&t.dataViews&&0!==t.dataViews.length&&t.dataViews[0]){var r=t.dataViews[0];this.settings=e.parseSettings(r);var n=null;r.scriptResult&&r.scriptResult.payloadBase64&&(n=r.scriptResult.payloadBase64),-1===i.indexOf(t.type)?n&&this.injectCodeFromPayload(n):this.onResizing(t.viewport)}},e.prototype.onResizing=function(e){},e.prototype.injectCodeFromPayload=function(e){if(t.ResetInjector(),e){var i=document.createElement(\"html\");try{i.innerHTML=window.atob(e)}catch(n){return}if(r||0===this.headNodes.length){for(;this.headNodes.length>0;){var a=this.headNodes.pop();document.head.removeChild(a)}var o=i.getElementsByTagName(\"head\");if(o&&o.length>0){var u=o[0];this.headNodes=t.ParseElement(u,document.head)}}for(;this.bodyNodes.length>0;){var a=this.bodyNodes.pop();this.rootElement.removeChild(a)}var s=i.getElementsByTagName(\"body\");if(s&&s.length>0){var l=s[0];this.bodyNodes=t.ParseElement(l,this.rootElement)}t.RunHTMLWidgetRenderer()}},e.parseSettings=function(e){return t.VisualSettings.parse(e)},e.prototype.enumerateObjectInstances=function(e){return t.VisualSettings.enumerateObjectInstances(this.settings||t.VisualSettings.getDefault(),e)},e}();t.Visual=n}(r=t.VerbatimExplorerD13F83D6C74E41AEAFBA81E2A78FFEDD||(t.VerbatimExplorerD13F83D6C74E41AEAFBA81E2A78FFEDD={}))}(r=t.visual||(t.visual={}))}(t=e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var r;!function(t){t.VerbatimExplorerD13F83D6C74E41AEAFBA81E2A78FFEDD={name:\"VerbatimExplorerD13F83D6C74E41AEAFBA81E2A78FFEDD\",displayName:\"List PBI R Packages\",\"class\":\"Visual\",version:\"1.0.0\",apiVersion:\"1.7.0\",create:function(t){return new e.extensibility.visual.VerbatimExplorerD13F83D6C74E41AEAFBA81E2A78FFEDD.Visual(t)},custom:!0}}(r=t.plugins||(t.plugins={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));","css":".visual-VerbatimExplorerD13F83D6C74E41AEAFBA81E2A78FFEDD .rcv_autoScaleImageContainer{position:relative}.visual-VerbatimExplorerD13F83D6C74E41AEAFBA81E2A78FFEDD .rcv_autoScaleImageContainer .rcv_autoScaleImage{max-width:100%;max-height:100%;position:absolute;top:50%;left:50%;transform:translateY(-50%) translateX(-50%);-webkit-transform:translateY(-50%) translateX(-50%)}","iconBase64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAHNUN2pAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACoUExURQAAAP9/P99/P+l/Ku9/L/J/M+x/Let/M+x/Nu1/Lu5/Mel8Nu6CMPB/M+x9M+x6Mu19M+57M+59NOt7L+x7MO17Me18Me58Mex8L+18MO19Mex9Mu59MOx9Me19Me18MOx8MOx9Me19Mex9MOx9MO19Mex9MO19Me19Mex9MO19MO19MOx8Mex8Me18MO18MOx8Me18MOx8MOx8Me18Me18MOx8MO19MUG9B/MAAAA3dFJOUwAECAwQFBwoKiwuLy82Nzg7PD9AREhYXGBkaHB4fICPl5ufo6evs7u/w8fLz9PX29/n6+/z9/tz0+kUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAyklEQVQYV22QBxKCMBBFV8VeELvYYxcp1n//m7lLFh0d3wzZl5+QRilI+LO2JLoS5WbSBSIesBww4baCFbcwMjo0kjO9WCUEBjFcUSBonGVZoid4PuaijKP1i6inMm0+cM+JecClj0A0MWugmJ4vAVonZGrmVrnwDk9RoovByBpRQWtGPq/ygf8FNiXtMV7ESy1qW8lDT8NdZ3KTYF+f+e2dhnyCm98JA3d8hb2qDRljxl0uv2Fa3k9aPmThsapRirNYmeXfd7IQvQAjrx9I9P1qZgAAAABJRU5ErkJggg=="}}